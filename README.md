# cuckoo-filter
cuckoo filter and it's implementation


### Introduction

- ["Cuckoo Filter: Practically Better Than Bloom"](http://www.cs.cmu.edu/~binfan/papers/conext14_cuckoofilter.pdf) in proceedings of ACM CoNEXT 2014 by Bin Fan, Dave Andersen and Michael Kaminsky
- I used `5-tuple` from a packet to testing the cuckoo filter.


### API

A cuckoo filter supports following operations:


*  `cuckoofilter cf(bits_per_item, n);`: generate a cuckoo filter with a `bits_per_item` bits fingerprint for every items, and it can only contian `n` 5-tuples.
*  `Add(item)`: insert an item to the filter
*  `Contain(item)`: return if item is already in the filter. Note that this method may return false positive results like Bloom filters
*  `Delete(item)`: delete the given item from the filter. Note that to use this method, it must be ensured that this item is in the filter (e.g., based on records on external storage); otherwise, a false item may be deleted.


### The false positive rate

---

#### A bucket can contain 4 fingerprints

| **fingerprint** | **test 1**   | **test 2**   | **test 3**   | **test 4**   | **test 5**   | **test 6**   |
| --------------- | ------------ | ------------ | ------------ | ------------ | ------------ | ------------ |
| **2**           | **67.0075%** | **55.2795%** | **67.1875%** | **73.5809%** | **73.7885%** | **66.6626%** |
| **3**           | 59.9670%     | 59.7168%     | 63.9130%     | 55.4993%     | 62.0667%     | 57.2815%     |
| **4**           | 40.5670%     | 40.4175%     | 40.5640%     | 36.9049%     | 40.2374%     | 41.0431%     |
| **5**           | 22.4335%     | 22.7997%     | 22.5250%     | 22.6532%     | 22.5037%     | 22.3724%     |
| **6**           | 8.2123%      | 11.4410%     | 11.7554%     | 13.3759%     | 11.6913%     | 11.5906%     |
| **7**           | 6.0120%      | 6.3507%      | 5.8014%      | 5.7495%      | 5.9082%      | 6.1005%      |
| **8**           | 3.8116%      | 2.9266%      | 3.0975%      | 3.0182%      | 3.0273%      | 2.8839%      |
| **9**           | 1.4679%      | 1.4404%      | 1.5656%      | 1.4618%      | 1.4282%      | 1.5778%      |
| **10**          | 0.7751%      | 0.6958%      | 0.9399%      | 0.8575%      | 0.7599%      | 0.8820%      |
| **11**          | 0.3754%      | 0.4425%      | 0.4181%      | 0.3540%      | 0.3876%      | 0.4547%      |
| **12**          | 0.1770%      | 0.2014%      | 0.2197%      | 0.1678%      | 0.1282%      | 0.1984%      |
| **13**          | 0.0793%      | 0.0946%      | 0.0946%      | 0.0946%      | 0.0885%      | 0.1099%      |
| **14**          | 0.0397%      | 0.0519%      | 0.0488%      | 0.0336%      | 0.0977%      | 0.0488%      |
| **15**          | 0.0427%      | 0.0305%      | 0.0275%      | 0.0244%      | 0.0214%      | 0.5768%      |
| **16**          | 0.0183%      | 0.0244%      | 0.0092%      | 0.0092%      | 0.0092%      | 0.0153%      |
| **17**          | 0.0031%      | 0.0092%      | 0.5188%      | 0.0000%      | 0.0061%      | 0.0031%      |
| **18**          | 0.0153%      | 0.0092%      | 3.6621%      | 0.0031%      | 0.0061%      | 0.1251%      |
| **19**          | 0.0031%      | 0.0031%      | 0.0031%      | 3.6499%      | 0.0000%      | 0.0000%      |
| **20**          | 0.0061%      | 0.0000%      | 0.0000%      | 0.5310%      | 0.0031%      | 0.0000%      |


#### Figure

![](https://img2018.cnblogs.com/blog/1092957/201905/1092957-20190528224358269-349334463.png)


#### A bucket can contain 8 fingerprints

| **fingerprint** | **test 1**   | **test 2**   | **test 3**   | **test 4**   | **test 5**   | **test 6**   |
| --------------- | ------------ | ------------ | ------------ | ------------ | ------------ | ------------ |
| **2**           | **94.0216%** | **96.9147%** | **95.6451%** | **96.0693%** | **96.7407%** | **96.8262%** |
| **3**           | 88.5925%     | 87.7075%     | 87.8937%     | 85.4370%     | 87.2284%     | 87.5763%     |
| **4**           | 65.2740%     | 65.3259%     | 65.5365%     | 65.7257%     | 65.2893%     | 64.7369%     |
| **5**           | 40.0757%     | 41.7999%     | 40.7440%     | 42.1509%     | 40.8783%     | 40.7196%     |
| **6**           | 21.9940%     | 22.5830%     | 22.4884%     | 22.7936%     | 22.7539%     | 22.4335%     |
| **7**           | 11.7279%     | 13.5834%     | 12.1246%     | 12.0605%     | 15.4785%     | 11.7920%     |
| **8**           | 6.3721%      | 6.1157%      | 6.3477%      | 6.0242%      | 7.0312%      | 6.0608%      |
| **9**           | 3.0823%      | 3.2104%      | 3.0426%      | 3.1433%      | 2.9144%      | 3.0457%      |
| **10**          | 1.9287%      | 1.8463%      | 1.6083%      | 2.6459%      | 2.5574%      | 1.4832%      |
| **11**          | 0.8148%      | 0.7355%      | 0.7416%      | 0.7629%      | 0.7996%      | 0.7446%      |
| **12**          | 0.3754%      | 0.4578%      | 0.3937%      | 0.3357%      | 0.3662%      | 0.3723%      |
| **13**          | 0.1617%      | 0.2167%      | 0.1556%      | 0.2289%      | 0.1984%      | 0.1801%      |
| **14**          | 0.1099%      | 0.0885%      | 0.0671%      | 0.0977%      | 0.1099%      | 0.0824%      |
| **15**          | 0.0732%      | 0.0732%      | 0.0580%      | 0.0671%      | 0.0397%      | 0.2563%      |
| **16**          | 0.0275%      | 0.0275%      | 1.3824%      | 0.2258%      | 0.0153%      | 0.0397%      |
| **17**          | 0.0214%      | 0.0336%      | 0.0122%      | 0.0061%      | 0.0153%      | 0.0092%      |
| **18**          | 0.0061%      | 0.0122%      | 0.0092%      | 0.0061%      | 0.0061%      | 0.0092%      |
| **19**          | 0.0092%      | 0.0000%      | 0.0092%      | 0.0031%      | 0.0000%      | 0.0000%      |
| **20**          | 0.0000%      | 0.0000%      | 0.0000%      | 0.0000%      | 0.0031%      | 0.0031%      |


#### Figure

![](https://img2018.cnblogs.com/blog/1092957/201905/1092957-20190528224420629-193511068.png)



### Space efficiency


- Note that I use a `u_char` array to store the fingerprint.  

---

#### A bucket can contain 4 fingerprints

| **fingerprint** | **test 1**  | **test 2**  | **test 3**  | **test 4**  | **test 5**  | **test 6**  |
| --------------- | ----------- | ----------- | ----------- | ----------- | ----------- | ----------- |
| **1**           | **2.0933%** | **1.9428%** | **1.6901%** | **2.5904%** | **2.4673%** | **1.8023%** |
| **2**           | 8.5087%     | 9.8175%     | 6.4789%     | 10.2356%    | 8.9317%     | 7.1239%     |
| **3**           | 25.2239%    | 22.2622%    | 25.8860%    | 30.2633%    | 19.5236%    | 29.3512%    |
| **4**           | 47.5052%    | 47.4686%    | 47.6288%    | 47.2755%    | 47.2778%    | 47.2099%    |
| **5**           | 59.7143%    | 60.2169%    | 59.8440%    | 60.0185%    | 59.9585%    | 59.8574%    |
| **6**           | 71.9398%    | 72.0234%    | 72.0417%    | 71.6583%    | 72.1195%    | 72.0703%    |
| **7**           | 84.5373%    | 84.1875%    | 84.1675%    | 84.3624%    | 84.2676%    | 84.1742%    |
| **8**           | 96.3409%    | 96.2631%    | 96.2341%    | 96.1975%    | 96.2875%    | 96.4584%    |
| **9**           | 54.1042%    | 54.1480%    | 54.2313%    | 54.0545%    | 54.0828%    | 54.1137%    |
| **10**          | 60.1120%    | 60.1540%    | 60.2837%    | 60.3685%    | 60.2293%    | 60.3590%    |
| **11**          | 66.1526%    | 66.1945%    | 66.3624%    | 66.2365%    | 66.1830%    | 66.4169%    |
| **12**          | 72.4686%    | 72.0829%    | 72.0085%    | 72.0509%    | 72.2088%    | 72.2488%    |
| **13**          | 51.7929%    | 78.0340%    | 78.3340%    | 78.0514%    | 78.3278%    | 78.2398%    |
| **14**          | 84.2943%    | 84.0460%    | 84.2249%    | 84.3077%    | 84.2636%    | 84.4772%    |
| **15**          | 90.6444%    | 90.2810%    | 90.6100%    | 90.4112%    | 90.4241%    | 90.6200%    |
| **16**          | 96.3913%    | 96.8109%    | 96.3165%    | 96.3409%    | 96.5820%    | 96.5439%    |
| **17**          | 67.9616%    | 68.3982%    | 68.1896%    | 67.6546%    | 68.2891%    | 45.1528%    |
| **18**          | 72.2969%    | 72.1001%    | 72.4262%    | 72.1046%    | 72.3083%    | 72.3495%    |
| **19**          | 76.1974%    | 76.1527%    | 76.3557%    | 76.5514%    | 75.9619%    | 76.2011%    |
| **20**          | 80.3998%    | 80.2294%    | 23.2417%    | 80.3439%    | 80.1773%    | 80.2269%    |


#### Figure

![](https://img2018.cnblogs.com/blog/1092957/201905/1092957-20190528224429525-1241020025.png)

#### A bucket can contain 8 fingerprints

| **fingerprint** | **test 1**  | **test 2**  | **test 3**  | **test 4**  | **test 5**  | **test 6**  |
| --------------- | ----------- | ----------- | ----------- | ----------- | ----------- | ----------- |
| **1**           | **4.2709%** | **4.1220%** | **4.6841%** | **4.3127%** | **3.9135%** | **4.8458%** |
| **2**           | 15.1699%    | 14.3383%    | 16.2834%    | 14.8155%    | 15.6071%    | 13.8321%    |
| **3**           | 34.3037%    | 34.1120%    | 34.2184%    | 35.1557%    | 33.7772%    | 34.2304%    |
| **4**           | 48.9594%    | 48.7236%    | 48.7068%    | 48.7190%    | 48.6900%    | 48.6252%    |
| **5**           | 61.8954%    | 61.6198%    | 61.8124%    | 61.8486%    | 61.7409%    | 57.1928%    |
| **6**           | 74.2813%    | 74.1474%    | 74.1131%    | 74.4141%    | 74.2664%    | 74.2241%    |
| **7**           | 86.7496%    | 86.5948%    | 86.7523%    | 86.5093%    | 86.6322%    | 86.6589%    |
| **8**           | 99.2645%    | 99.1531%    | 99.0112%    | 98.8831%    | 98.8098%    | 98.9822%    |
| **9**           | 55.7187%    | 55.7685%    | 55.5410%    | 55.6217%    | 55.7101%    | 55.7487%    |
| **10**          | 61.8801%    | 61.8677%    | 61.9268%    | 61.9783%    | 61.8906%    | 61.9316%    |
| **11**          | 68.1227%    | 68.1846%    | 67.9706%    | 68.2014%    | 68.1080%    | 68.1615%    |
| **12**          | 74.1909%    | 74.3809%    | 74.2573%    | 68.6314%    | 68.6314%    | 74.3145%    |
| **13**          | 74.3506%    | 80.4913%    | 80.5880%    | 80.4417%    | 80.4578%    | 80.5334%    |
| **14**          | 86.8097%    | 86.3972%    | 86.6669%    | 86.7790%    | 86.5654%    | 86.8618%    |
| **15**          | 92.9060%    | 92.5941%    | 92.8416%    | 92.9246%    | 92.9132%    | 92.8159%    |
| **16**          | 98.8083%    | 98.9792%    | 99.1058%    | 98.9243%    | 99.2462%    | 91.5085%    |
| **17**          | 70.1946%    | 70.2119%    | 70.1946%    | 70.2346%    | 70.3016%    | 70.0162%    |
| **18**          | 74.4381%    | 74.3500%    | 74.3111%    | 74.2664%    | 74.3443%    | 74.2184%    |
| **19**          | 78.4600%    | 78.2933%    | 78.4938%    | 78.3791%    | 72.4442%    | 78.4286%    |
| **20**          | 82.6645%    | 82.3288%    | 82.5793%    | 82.5640%    | 82.3110%    | 82.5551%    |

#### Figure

![](https://img2018.cnblogs.com/blog/1092957/201905/1092957-20190528224431781-100500229.png)
